<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Fetcher</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>

<body class="bg-gray-100">
    <div id="cameraImages" class="p-4 grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3"></div>
    <script>
        fetch('data-camera.json')
            .then(response => response.json())
            .then(data => {
                console.log('Fetched data:', data); // Log the fetched data
                const imageIds = data;

                if (!imageIds) {
                    throw new Error('imageIds is undefined');
                }

                function fetchImages() {
                    const container = document.getElementById('cameraImages');

                    imageIds.forEach((id, index) => {
                        let img = container.querySelector(`img[data-index="${index}"]`);
                        if (!img) {
                            img = document.createElement('img');
                            img.dataset.index = index;
                            img.alt = `Camera Image ${index + 1}`;
                            img.className = "w-full h-auto rounded shadow";
                            container.appendChild(img);
                        }
                        img.src = `get.php?url=http://giaothong.hochiminhcity.gov.vn:8007/Render/CameraHandler.ashx?id=${id}&${new Date().getTime()}`; // Adding timestamp to avoid caching
                    });
                }

                // Call fetchImages every 3 seconds (3000 milliseconds)
                setInterval(fetchImages, 3000);

                // Initial call to display the images immediately on page load
                fetchImages();
            })
            .catch(error => console.error('Error fetching image IDs:', error));
    </script>
</body>

</html>